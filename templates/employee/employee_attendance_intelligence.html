{% extends "common/layout_base.html" %}
{% block page_title %}My Attendance Intelligence{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-8 space-y-10">

  <!-- HEADER -->
  <div>
    <h1 class="text-3xl font-black text-slate-900">My Attendance</h1>
    <p class="text-sm text-slate-500 mt-1">
      A clear view of your attendance health
    </p>
  </div>

  <!-- PRIMARY KPI -->
  <div class="bg-white border rounded-lg p-8 flex items-center justify-between">
    <div>
      <p class="text-xs uppercase text-slate-400">Attendance Score</p>
      <p class="text-4xl font-black">
        {{ metrics.attendance_score | default(0) }}/100
      </p>
    </div>

    <div class="text-right">
      <p class="text-xs uppercase text-slate-400">Status</p>
      <p class="text-xl font-black
        {% if metrics.risk_level == 'low' %}
          text-green-600
        {% elif metrics.risk_level == 'medium' %}
          text-orange-600
        {% else %}
          text-red-600
        {% endif %}
      ">
        {{ metrics.risk_level | default('unknown') | upper }}
      </p>
    </div>
  </div>

  <!-- SUPPORTING METRICS -->
  <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
    <div class="bg-white border p-6 rounded-lg">
      <p class="text-xs uppercase text-slate-400">Late</p>
      <p class="text-2xl font-black text-orange-600">
        {{ metrics.late_arrival_days | default(0) }}
      </p>
    </div>

    <div class="bg-white border p-6 rounded-lg">
      <p class="text-xs uppercase text-slate-400">Absent</p>
      <p class="text-2xl font-black text-red-600">
        {{ metrics.absent_days | default(0) }}
      </p>
    </div>

    <div class="bg-white border p-6 rounded-lg">
      <p class="text-xs uppercase text-slate-400">Leave</p>
      <p class="text-2xl font-black text-slate-700">
        {{ metrics.leave_days | default(0) }}
      </p>
    </div>

    <div class="bg-white border p-6 rounded-lg">
      <p class="text-xs uppercase text-slate-400">Avg Hours</p>
      <p class="text-2xl font-black">
        {{ metrics.average_work_hours | default(0) }}
      </p>
    </div>
  </div>

  <!-- SCORE BREAKDOWN CHART -->
  <div class="bg-white border rounded-lg p-6">
    <h2 class="text-sm font-black uppercase tracking-widest mb-4">
      Score Breakdown
    </h2>
    <div class="h-[260px]">
      <canvas id="employeeChart"></canvas>
    </div>
  </div>

  <!-- ALERTS -->
  <div>
    <h2 class="text-sm font-black uppercase tracking-widest mb-4">
      Observations
    </h2>

    {% if anomalies %}
      {% for a in anomalies %}
        <div class="border-l-4 border-orange-400 bg-orange-50 p-4 mb-3">
          <p class="font-medium">{{ a.reason }}</p>
          <p class="text-xs text-slate-500">{{ a.date }}</p>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-sm text-slate-400">No unusual patterns detected</p>
    {% endif %}
  </div>

</div>

<!-- CHART.JS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById("employeeChart"), {
  type: "bar",
  data: {
    labels: {{ metrics.chart_breakdown["labels"] | default([]) | tojson }},
    datasets: [{
      data: {{ metrics.chart_breakdown["values"] | default([]) | tojson }},
      backgroundColor: ["#16a34a", "#dc2626", "#64748b", "#f59e0b"],
      borderRadius: 6
    }]
  },
  options: {
    responsive: true,
    maintainAspectRatio: false,
    plugins: {
      legend: { display: false }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { stepSize: 1 }
      }
    }
  }
});
</script>
{% endblock %}
